#!/usr/bin/env bash

# Bash completion for Omni2tree commands.

_o2t_sra_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="-i --input -o --outdir -c --chunk-size -w --sleep-secs -l --layout -d --debug -h --help"

  case "$prev" in
    -i|--input)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
    -o|--outdir)
      COMPREPLY=( $(compgen -d -- "$cur") )
      return 0
      ;;
    -l|--layout)
      COMPREPLY=( $(compgen -W "SINGLE PAIRED" -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

_o2t_step1_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="-i --input -g --outgroup --o2t_out --temp_dir --resume --og_min_fraction \
        -p --use_mat_peptides -q --use_mat_peptides_only -T --threads --debug -h --help"

  case "$prev" in
    -i|--input|-g|--outgroup)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
    --o2t_out|--temp_dir)
      COMPREPLY=( $(compgen -d -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

_o2t_step2_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="-r --reads -t --read_type -map_op --minimap2_options -T --threads --temp_dir --o2t_out \
        --stats_file --dedup --dedup_l --downsample --coverage --genome_size \
        --num_bases --num_reads --debug -h --help"

  case "$prev" in
    -r|--reads|--stats_file)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
    --temp_dir|--o2t_out)
      COMPREPLY=( $(compgen -d -- "$cur") )
      return 0
      ;;
    -t|--read_type)
      COMPREPLY=( $(compgen -W "single paired" -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

_o2t_step3_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="--o2t_out -l --label -m --metadata --seq_type -T --threads --bootstrap --temp_dir --debug \
        --exclude_pattern --filter_column --filter_value --group_by --min_samples --exclude_gaps \
        --add_domain -h --help"

  case "$prev" in
    --o2t_out|--temp_dir)
      COMPREPLY=( $(compgen -d -- "$cur") )
      return 0
      ;;
    -m|--metadata|--add_domain)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
    --seq_type)
      COMPREPLY=( $(compgen -W "aa dna AA DNA" -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

_o2t_calculate_entropy_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="--input --output --metadata --group_by --min_samples --exclude_gaps -h --help"

  case "$prev" in
    --input|--output|--metadata)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

_o2t_msa_to_position_table_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="--msa_dir --og_table --output --seq_type --metadata --filter_column --filter_value \
        --exclude_pattern --include_all -h --help"

  case "$prev" in
    --msa_dir)
      COMPREPLY=( $(compgen -d -- "$cur") )
      return 0
      ;;
    --og_table|--output|--metadata)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
    --seq_type)
      COMPREPLY=( $(compgen -W "AA DNA" -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

_o2t_plot_entropy_r_complete() {
  local cur
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"

  case "$COMP_CWORD" in
    1)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
    2)
      COMPREPLY=( $(compgen -d -- "$cur") )
      return 0
      ;;
    3)
      COMPREPLY=( $(compgen -W "AA DNA" -- "$cur") )
      return 0
      ;;
  esac
}

_o2t_omni2treeview_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="-n --nwk_file -m --meta -c --code -o --output -t --template -l --name -h --help"

  case "$prev" in
    -n|--nwk_file|-m|--meta|-c|--code|-t|--template|-o|--output)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

_o2t_prepare_metadata_o2t_view_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="-m --metadata --five_letter --in_nwk --out_nwk --out_meta -h --help"

  case "$prev" in
    -m|--metadata|--five_letter|--in_nwk|--out_nwk|--out_meta)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

_o2t_validate_metadata_complete() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  opts="-m --metadata --five_letter --o2t_results -h --help"

  case "$prev" in
    -m|--metadata|--five_letter)
      COMPREPLY=( $(compgen -f -- "$cur") )
      return 0
      ;;
    --o2t_results)
      COMPREPLY=( $(compgen -d -- "$cur") )
      return 0
      ;;
  esac

  if [[ "$cur" == -* ]]; then
    COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
  fi
}

complete -o default -F _o2t_sra_complete o2t-sra
complete -o default -F _o2t_step1_complete o2t-step1
complete -o default -F _o2t_step2_complete o2t-step2
complete -o default -F _o2t_step3_complete o2t-step3
complete -o default -F _o2t_calculate_entropy_complete calculate_entropy.py
complete -o default -F _o2t_msa_to_position_table_complete msa_to_position_table.py
complete -o default -F _o2t_plot_entropy_r_complete plot_entropy.R
complete -o default -F _o2t_omni2treeview_complete omni2treeview.py
complete -o default -F _o2t_prepare_metadata_o2t_view_complete prepare_metadata_o2t_view.py
complete -o default -F _o2t_validate_metadata_complete validate_metadata.py
